name: Next.js 15 Build Test

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  build:
    name: Build & Test Next.js 15 with pnpm
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 8

      - name: ğŸ”§ Setup Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "pnpm"

      - name: ğŸ“‹ Install dependencies
        run: |
          echo "Installing dependencies with pnpm..."
          pnpm install --no-frozen-lockfile

      - name: ğŸ” TypeScript check (warning only)
        run: |
          echo "Running TypeScript type checking..."
          pnpm run type-check || echo "âš ï¸ TypeScript íƒ€ì… ì—ëŸ¬ê°€ ìˆì§€ë§Œ ë¹Œë“œë¥¼ ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤"
        continue-on-error: true

      - name: ğŸ§¹ ESLint check (warning only)
        run: |
          echo "Running ESLint..."
          pnpm run lint || echo "âš ï¸ ESLint ê²½ê³ ê°€ ìˆì§€ë§Œ ë¹Œë“œë¥¼ ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤"
        continue-on-error: true

      - name: ğŸ—ï¸ Build Next.js 15 application
        run: |
          echo "Building Next.js 15 application with pnpm..."
          pnpm run build
        env:
          NODE_ENV: production
          NEXT_TELEMETRY_DISABLED: 1
          SERVER_URL: ${{ secrets.SERVER_URL }}Add commentMore actions
          NEXT_PUBLIC_SERVER_URL: ${{ secrets.NEXT_PUBLIC_SERVER_URL }}
          NEXTAUTH_SECRET: ${{ secrets.NEXTAUTH_SECRET }}
          SALT_ROUNDS: ${{ secrets.SALT_ROUNDS }}
          API_MOCKING: ${{ secrets.API_MOCKING }}
          NEXT_PUBLIC_API_MOCKING: ${{ secrets.NEXT_PUBLIC_API_MOCKING }}

      - name: âœ… Build success notification
        if: success()
        run: |
          echo "ğŸ‰ Next.js 15 ë¹Œë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
          echo "âœ¨ pnpmìœ¼ë¡œ ëª¨ë“  ì¢…ì†ì„±ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤"
          echo "ğŸš€ í”„ë¡œë•ì…˜ ë¹Œë“œê°€ ë¬¸ì œì—†ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤"

      - name: ğŸ“¤ Upload build artifacts
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: nextjs-build
          path: .next/
          retention-days: 1

      - name: âŒ Build failure notification
        if: failure()
        run: |
          echo "ğŸ’¥ Next.js 15 ë¹Œë“œê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤!"
          echo "ğŸ” ìœ„ì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•´ì£¼ì„¸ìš”"
          exit 1
